--[[
    [자동 UI 생성기]
    위치: StarterPlayer > StarterPlayerScripts > LocalScript
    기능: 게임 시작 시 화면에 필요한 UI(경험치바, 자동버튼)를 코드로 그려줌
]]

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- 1. ScreenGui 생성 (전체 UI 틀)
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "GameMainUI"
screenGui.ResetOnSpawn = false -- 죽어도 UI 유지
screenGui.Parent = playerGui

-- === 하단 경험치 바 ===
local expBarBg = Instance.new("Frame")
expBarBg.Name = "ExpBarBackground"
expBarBg.Size = UDim2.new(0.4, 0, 0.05, 0) -- 화면 중앙 하단 너비 40%
expBarBg.Position = UDim2.new(0.3, 0, 0.85, 0) -- 위치
expBarBg.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
expBarBg.BorderSizePixel = 2
expBarBg.Parent = screenGui

local expBarFill = Instance.new("Frame")
expBarFill.Name = "ExpBarFill"
expBarFill.Size = UDim2.new(0, 0, 1, 0) -- 처음엔 0%
expBarFill.BackgroundColor3 = Color3.fromRGB(0, 255, 100) -- 밝은 초록색
expBarFill.BorderSizePixel = 0
expBarFill.Parent = expBarBg

local levelText = Instance.new("TextLabel")
levelText.Name = "LevelText"
levelText.Size = UDim2.new(1, 0, 1, 0)
levelText.BackgroundTransparency = 1
levelText.Text = "Lv. 1 [ 0 / 100 ]"
levelText.TextColor3 = Color3.new(1, 1, 1)
levelText.Font = Enum.Font.FredokaOne
levelText.TextScaled = true
levelText.Parent = expBarBg

-- === 우측 자동사냥 버튼 ===
local autoBtn = Instance.new("TextButton")
autoBtn.Name = "AutoButton"
autoBtn.Size = UDim2.new(0.12, 0, 0.08, 0)
autoBtn.Position = UDim2.new(0.85, 0, 0.5, 0)
autoBtn.BackgroundColor3 = Color3.fromRGB(255, 80, 80) -- 꺼짐(빨강)
autoBtn.Text = "AUTO: OFF"
autoBtn.TextColor3 = Color3.new(1, 1, 1)
autoBtn.Font = Enum.Font.FredokaOne
autoBtn.TextScaled = true
autoBtn.Parent = screenGui
-- 버튼 둥글게 깎기
local uiCorner = Instance.new("UICorner")
uiCorner.CornerRadius = UDim.new(0.2, 0)
uiCorner.Parent = autoBtn

-- 2. 기능 연결

-- (1) 경험치 바 업데이트 함수
local function updateExpBar()
	local stats = player:FindFirstChild("leaderstats")
	local hidden = player:FindFirstChild("HiddenStats")
	if not stats or not hidden then return end

	local cur = hidden.CurrentExp.Value
	local max = hidden.MaxExp.Value
	local lvl = stats.Level.Value

	-- 비율 계산 (0 ~ 1)
	local ratio = math.clamp(cur / max, 0, 1)

	-- UI 적용
	expBarFill:TweenSize(UDim2.new(ratio, 0, 1, 0), "Out", "Quad", 0.2, true)
	levelText.Text = string.format("Lv. %d [ %d / %d ]", lvl, cur, max)
end

-- 리모트 이벤트 감지 (서버가 업데이트 하라고 신호 줄 때)
local remotes = ReplicatedStorage:WaitForChild("Remotes")
remotes.UpdateStats.OnClientEvent:Connect(updateExpBar)

-- 초기 1회 실행 (약간 딜레이 줘서 스탯 로딩 기다림)
task.delay(1, updateExpBar)


-- (2) 자동사냥 버튼 기능
autoBtn.MouseButton1Click:Connect(function()
	local autoVal = player:FindFirstChild("AutoClickState")
	if autoVal then
		-- 값 토글 (true <-> false)
		autoVal.Value = not autoVal.Value

		-- 버튼 색상 및 텍스트 변경
		if autoVal.Value then
			autoBtn.BackgroundColor3 = Color3.fromRGB(80, 255, 80) -- 켜짐(초록)
			autoBtn.Text = "AUTO: ON"
		else
			autoBtn.BackgroundColor3 = Color3.fromRGB(255, 80, 80) -- 꺼짐(빨강)
			autoBtn.Text = "AUTO: OFF"
		end
	end
end)
